!function(){"use strict";var Timesheet=function(container,type,min,max,data){this.type="serial"===type||"parallel"===type?type:"parallel",this.data=[],this.year={min:min,max:max},this.bubbles=[],this.widthYear=0,this.parse(data||[]),"undefined"!=typeof document&&(this.container="string"==typeof container?document.querySelector("#"+container):container,this.drawSections(),this.insertData())};Timesheet.prototype.parse=function(data){try{for(var n=0;n<data.length;n++){if(5!==data[n].length)throw"Not enough input parameters for bubble "+(n+1);var beg=this.parseDate(data[n][0]),end=""!==data[n][1]?this.parseDate(data[n][1]):null,label=data[n][2],bubbleType=""!==data[n][3]?data[n][3]:"default",link=""!==data[n][4]?data[n][4]:"";beg.getFullYear()<this.year.min&&(this.year.min=beg.getFullYear()),end&&end.getFullYear()>this.year.max?this.year.max=end.getFullYear():beg.getFullYear()>this.year.max&&(this.year.max=beg.getFullYear()),this.data.push({start:beg,end:end,label:label,bubbleType:bubbleType}),this.bubbles.push(this.createBubble(beg,end,this.year.min,this.year.max,link))}}catch(err){console.error(err)}},Timesheet.prototype.parseDate=function(date){return-1===date.indexOf("/")?(date=new Date(parseInt(date,10),0,1),date.hasMonth=!1):(date=date.split("/"),date=new Date(parseInt(date[1],10),parseInt(date[0],10)-1,1),date.hasMonth=!0),date},Timesheet.prototype.drawSections=function(){for(var html=[],c=this.year.min;c<=this.year.max;c++)html.push("<section>"+c+"</section>");this.container.className="timesheet",this.container.innerHTML='<div class="scale">'+html.join("")+"</div>"},Timesheet.prototype.insertData=function(){"parallel"===this.type?this.generateMarkupParallel():"serial"===this.type&&this.generateMarkupSerial()},Timesheet.prototype.generateMarkupParallel=function(){var html=[];this.widthYear=this.container.querySelector(".scale section").offsetWidth;for(var n=0;n<this.bubbles.length;n++){var bubble=this.bubbles[n],bubbleData=this.data[n],line=['<span style="margin-left: '+bubble.monthOffsetStart*this.widthYear/12+"px; width: "+bubble.getWidth(this.widthYear)+'px;" class="bubble bubble-'+bubbleData.bubbleType+'" data-duration="'+bubble.monthsLength+'">'+(""!==bubble.link?'<a href="'+bubble.link+'">&gt;&gt;</a></span>':"</span>")+'<span style="margin-left: '+bubble.monthOffsetStart*this.widthYear/12+'px;"><span class="date">'+bubble.getDateLabel()+"</span>",'<span class="label">'+bubbleData.label+"</span></span>"].join("");html.push("<li>"+line+"</li>")}this.container.innerHTML+='<ul class="data">'+html.join("")+"</ul>"},Timesheet.prototype.generateMarkupSerial=function(){},Timesheet.prototype.createBubble=function(start,end,timesheetYearMin,timesheetYearMax,link){if(null===end){var currentDate=new Date,maxDate=new Date(this.year.max,12,31);end=currentDate.getTime()<maxDate.getTime()?currentDate:maxDate}return new Bubble(start,end,timesheetYearMin,timesheetYearMax,link)};var Bubble=function(start,end,timesheetYearMin,timesheetYearMax,link){this.start=start,this.end=end,this.timesheetYearMin=timesheetYearMin,this.timesheetYearMax=timesheetYearMax,this.monthOffsetStart=this.getStartOffset(),this.monthOffsetEnd=this.getEndOffset(),this.monthsLength=this.monthOffsetEnd-this.monthOffsetStart,this.link=link};Bubble.prototype.getStartOffset=function(){return 12*(this.start.getFullYear()-this.timesheetYearMin)+this.start.getMonth()},Bubble.prototype.getEndOffset=function(){return 12*(this.end.getFullYear()-this.timesheetYearMin)+this.end.getMonth()},Bubble.prototype.formatMonth=function(num){return num=parseInt(num,10),num>=10?num:"0"+num},Bubble.prototype.getWidth=function(widthYear){return widthYear/12*this.monthsLength},Bubble.prototype.getDateLabel=function(){return[(this.start.hasMonth?this.formatMonth(this.start.getMonth()+1)+"/":"")+this.start.getFullYear(),this.end?"-"+((this.end.hasMonth?this.formatMonth(this.end.getMonth()+1)+"/":"")+this.end.getFullYear()):""].join("")},window.Timesheet=Timesheet}();