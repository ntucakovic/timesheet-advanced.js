!function(){"use strict";function merge(target,source){"object"!=typeof target&&(target={});for(var property in source)if(source.hasOwnProperty(property)){var sourceProperty=source[property];if("object"==typeof sourceProperty){target[property]=merge(target[property],sourceProperty);continue}target[property]=sourceProperty}for(var a=2,l=arguments.length;l>a;a++)merge(target,arguments[a]);return target}var Timesheet=function(data,options){this.options=this.mergeWithDefault(options),this.data=[],this.bubbles=[],this.widthYear=0,this.parse(data||[]),"undefined"!=typeof document&&(this.container="string"==typeof this.options.container?document.querySelector("#"+this.options.container):this.options.container,this.drawSections(),this.drawCurrentMonth(),this.insertData())};Timesheet.prototype.mergeWithDefault=function(options){var defaults={container:"timesheet",type:"parallel",theme:"dark",extraClass:"",showDate:!0,timesheetYearMin:null,timesheetYearMax:null};return merge(defaults,options)},Timesheet.prototype.parse=function(data){for(var n=0;n<data.length;n++){if(5!==data[n].length)throw"Not enough input parameters for bubble "+(n+1);var beg=this.parseDate(data[n][0]),end=""!==data[n][1]?this.parseDate(data[n][1]):null,label=data[n][2],bubbleType=""!==data[n][3]?data[n][3]:"default",link=""!==data[n][4]?data[n][4]:"";beg.getFullYear()<this.year.min&&(this.year.min=beg.getFullYear()),end&&end.getFullYear()>this.year.max?this.year.max=end.getFullYear():beg.getFullYear()>this.year.max&&(this.year.max=beg.getFullYear()),this.data.push({start:beg,end:end,label:label,bubbleType:bubbleType}),this.bubbles.push(this.createBubble({start:beg,end:end,type:bubbleType,label:label,timesheetYearMin:this.year.min,timesheetYearMax:this.year.max,link:link}))}},Timesheet.prototype.parseDate=function(date){return-1===date.indexOf("/")?(date=new Date(parseInt(date,10),0,1),date.hasMonth=!1):(date=date.split("/"),date=new Date(parseInt(date[1],10),parseInt(date[0],10)-1,1),date.hasMonth=!0),date},Timesheet.prototype.drawSections=function(){for(var html=[],c=this.options.timesheetYearMin;c<=this.options.timesheetYearMax;c++)html.push("<section>"+c+"</section>");this.container.className="timesheet timesheet--"+this.options.type,this.options.extraClass.length&&(this.container.className+=" "+this.options.extraClass),this.container.innerHTML='<div class="scale">'+html.join("")+"</div>"},Timesheet.prototype.drawCurrentMonth=function(){var date=new Date;if(this.options.timesheetYearMax>=date.getFullYear()&&this.options.timesheetYearMax===date.getFullYear()&&date.getMonth()<12){this.widthYear=this.container.querySelector(".scale section").offsetWidth;var currentMonthOffset=12*(this.options.timesheetYearMax-this.options.timesheetYearMin)+date.getMonth();this.container.innerHTML+='<div class="ts-vertical-line" style="left: '+currentMonthOffset*(this.widthYear/12)+'px;"></div>'}},Timesheet.prototype.insertData=function(){"parallel"===this.options.type?this.generateMarkupParallel():"serial"===this.options.type&&this.generateMarkupSerial()},Timesheet.prototype.generateMarkupParallel=function(){var html=[];this.widthYear=this.container.querySelector(".scale section").offsetWidth;for(var startTag="",endTag="",n=0;n<this.bubbles.length;n++){var bubble=this.bubbles[n];""!==bubble.link?(startTag='<a class="bubble-link" href="'+bubble.link+'" style="margin-left: '+bubble.monthOffsetStart*this.widthYear/12+'px;">',endTag="</a>"):(startTag='<span style="margin-left: '+bubble.monthOffsetStart*this.widthYear/12+'px;">',endTag="</span>");var line=['<span style="margin-left: '+bubble.monthOffsetStart*this.widthYear/12+"px; width: "+bubble.getWidth(this.widthYear)+'px;" class="bubble bubble-'+bubble.type+'" data-duration="'+bubble.monthsLength+'"></span>'+startTag+'<span class="date">'+bubble.getDateLabel()+"</span>",'<span class="label">'+bubble.label+"</span>"+endTag].join("");html.push("<li>"+line+"</li>")}this.container.innerHTML+='<ul class="data">'+html.join("")+"</ul>"},Timesheet.prototype.generateMarkupSerial=function(){var i,j,currentList,currentBubble,html=[];this.widthYear=this.container.querySelector(".scale section").offsetWidth;var lists=this.buildSerialBubbleLists();for(html.push('<ul class="data">'),i=0;i<lists.length;i++)if(currentList=lists[i],currentList.bubbles.length){html.push("<li>"),html.push('<ul class="ts-bubbles-wrapper">');var line=[];for(j=0;j<currentList.bubbles.length;j++)currentBubble=currentList.bubbles[j],line.push("<li>",'<span style="left: '+currentBubble.monthOffsetStart*this.widthYear/12+"px; width: "+currentBubble.getWidth(this.widthYear)+'px;" class="bubble bubble-'+currentBubble.type+'" data-duration="'+currentBubble.monthsLength+'"></span>','<span class="info-wrapper">','<span class="date">'+currentBubble.getDateLabel()+"</span>",'<span class="label">'+currentBubble.label+"</span>","</span>","</li>");html.push(line.join("")),html.push("</ul>"),html.push("</li>")}html.push("</ul>"),this.container.innerHTML+=html.join("")},Timesheet.prototype.buildSerialBubbleLists=function(){var i,j,list,bubble,lists=[{monthOffsetEnd:0,bubbles:[]}];for(i=0;i<this.bubbles.length;i++)for(bubble=this.bubbles[i],j=0;j<lists.length;j++){if(list=lists[j],!list.monthOffsetEnd||list.monthOffsetEnd+1<=bubble.monthOffsetStart){lists[j].bubbles.push(bubble),lists[j].monthOffsetEnd=bubble.monthOffsetEnd;break}if(j===lists.length-1){lists[j+1]={monthOffsetEnd:bubble.monthOffsetEnd,bubbles:[bubble]};break}}return lists},Timesheet.prototype.createBubble=function(options){if(null===options.end){var currentDate=new Date,maxDate=new Date(this.options.timesheetYearMax,12,31);currentDate.getTime()<maxDate.getTime()?options.end=currentDate:options.end=maxDate}return new Bubble(options)};var Bubble=function(options){this.start=options.start,this.end=options.end,this.timesheetYearMin=options.timesheetYearMin,this.timesheetYearMax=options.timesheetYearMax,this.monthOffsetStart=this.getStartOffset(),this.monthOffsetEnd=this.getEndOffset(),this.monthsLength=this.monthOffsetEnd-this.monthOffsetStart,this.link=options.link,this.type=options.type,this.label=options.label};Bubble.prototype.getStartOffset=function(){return 12*(this.start.getFullYear()-this.timesheetYearMin)+this.start.getMonth()},Bubble.prototype.getEndOffset=function(){return 12*(this.end.getFullYear()-this.timesheetYearMin)+this.end.getMonth()},Bubble.prototype.formatMonth=function(num){return num=parseInt(num,10),num>=10?num:"0"+num},Bubble.prototype.getWidth=function(widthYear){return widthYear/12*this.monthsLength},Bubble.prototype.getDateLabel=function(){return[(this.start.hasMonth?this.formatMonth(this.start.getMonth()+1)+"/":"")+this.start.getFullYear(),this.end?"-"+((this.end.hasMonth?this.formatMonth(this.end.getMonth()+1)+"/":"")+this.end.getFullYear()):""].join("")},window.Timesheet=Timesheet}();